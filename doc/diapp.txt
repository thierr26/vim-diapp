*diapp.txt* Commands (hopefully) useful for software development activities


Author:		Thierry Rascle <thierr26@free.fr>
For Vim:	7.0 and later
Last change:	2020-07-24


                               DIAPP USER MANUAL

==============================================================================


CONTENTS                                                      *diapp-contents*

	GENERAL INFORMATION  . . . . . . . . . . . |diapp-general-information|
	GPRBUILD RELATED COMMANDS  . . . . . . . . |diapp-gprbuild|
	FILE RINGS RELATED COMMANDS  . . . . . . . |diapp-file-ring|
	VIM HELP FILE RELATED ACTIONS AND COMMANDS |diapp-vimhelp|
	CREDITS AND LICENSE  . . . . . . . . . . . |diapp-license|

==============================================================================


GENERAL INFORMATION                                *diapp-general-information*

Disabling Diapp~
                                                              *g:loaded_diapp*
Set g:loaded_diapp to 1 in your |.vimrc| to disable entirely Diapp. >

	:let g:loaded_diapp = 1
<

Diapp installation checking~
                                                      *:EchoDiappFeatureNames*
Diapp's functionnalities are mostly coded in `autoload` scripts. Each of
Diapp's autoload scripts defines a set of commands (also called a "feature").
One defines the GPRbuild related commands, another one defines the file rings
related commands, etc.

On startup, Diapp checks the presence of the autoload scripts. If they are not
found, then Diapp won't work at all (and a message is displayed to inform you).
If they're found, then Diapp should work properly and the features names can
be listed with the following command: >

	:EchoDiappFeatureNames
<

Diapp commands availability~
                                                 *diapp-commands-availability*
Diapp does not systematically refresh its user interface, based on the type of
the file you are editing (see |filetype|). This implies that when trying to
use the commands documented in this manual, you may experience error |E492|
("not an editor command"). It means that Diapp has not defined the command you
are trying to use because it's not useful at the moment. Editing another type
of file may result in the command being defined.

User interface refresh management~
                                                  *g:diapp_min_refresh_period*
If Vim has been compiled with the `+reltime` feature, then Diapp avoids
refreshing the user interface repetitively for a given buffer, which could
happen due to |autocommands| being triggered for multiple events (|BufEnter|,
|FileType|). A period parameter is used, which defaults to 1.8s. Set
g:diapp_min_refresh_period to a different value (in seconds) in your |.vimrc|
if needed (but it shouldn't be needed).

Diapp menus~
                                                                 *diapp-menus*
Diapp creates menus, available to users running a version of Vim with the
|GUI| (and with |menus| not hidden of course). The absence of a menu or menu
item means that the associated command(s) are not available because they're
not useful at the moment. A menu item may also be present but disabled
(grayed), which means it's not useful at the moment. In this case, an
informational text may appear instead of the normal menu item label to
indicate why it's disabled.

:AF command ("auto fill")~
                                                             *diapp-auto-fill*
                                                                         *:AF*
When available, and if provided with 0, 1 or 2 valid arguments, the `:AF`
command writes after the cursor (like |a|) a pattern as many times as needed
to obtain a line of a given length. The last occurrence of the pattern may be
truncated.

The line length is by default the value of 'textwidth' but a specific line
length can be provided as argument.

If no pattern is provided as argument, then the pattern defaults to the
character under the cursor if the current line is not empty or to a string
which depends on the file type. See:
- |diapp-gprbuild-auto-fill|
- |diapp-vimhelp-auto-fill|

Example #1 - use the default pattern and the default line length: >

	:AF
<

Example #2 - provide a pattern as argument (note the escaping of the space
character): >

	:AF \ .
<

Example #3 - provide both a pattern and a line length as argument (the order
of the arguments is not significant): >

	:AF \ . 50
<

==============================================================================


GPRBUILD RELATED COMMANDS                                     *diapp-gprbuild*

                                                   *g:diapp_gprbuild_disabled*
Set g:diapp_gprbuild_disabled to 1 in your |.vimrc| to disable the whole set
of commands described in this section. >

	:let g:diapp_gprbuild_disabled = 1
<

GNAT project file selection~

Diapp automatically selects a GNAT project file (.gpr file) if it finds a
"concrete" one that seems appropriate.

Diapp starts searching in the current working directory. If a default.gpr file
is found, then Diapp selects it as the GNAT project file. Otherwise, Diapp
checks the other .gpr files (if any) and selects one of them based on the
following rules:

	Diapp does not select an abstract project (i.e. one that is defined
	using the "abstract" reserved word).

	Priority is given to files with a name ending with _test.gpr.

If no GNAT project is selected after searching in the current working
directory, then the same search is done in its parent directory. And so on, up
to the root of the file system.

                                           *g:diapp_gprbuild_default_gpr_file*
You can force Diapp to automatically select a GNAT project file by setting
g:diapp_gprbuild_default_gpr_file in your |.vimrc| file. >

	:let g:diapp_gprbuild_default_gpr_file = path/to/the/gnat_project.gpr
<

:SelectCurGPRFile                                          *:SelectCurGPRFile*
		Make the currently edited file the selected GNAT project file
		(only if the currently edited file is a non abstract GNAT
		project file).

:SelectGPRFile {file}                                         *:SelectGPRFile*
		Make file {file} the selected GNAT project (only if {file} is
		a non abstract GNAT project file). >

			:SelectGPRFile path/to/gnat_project_file.gpr
<

                                                                *:EchoGPRFile*
:EchoGPRFile	Echo the name of the currently selected GNAT project file (if
		any).

GPRbuild options management~

:SetGPRbuildOpt {options}                                    *:SetGPRbuildOpt*
		Define options to be used in GPRbuild commands. Options
		provided in {options} are used in addition to options that
		Diapp unconditionally passes to GPRbuild (see
		|:GPRbuildCompileCurFile| for more details). Example: >

			:SetGPRbuildOpt -eL -XBUILD=DEBUG
<

                                   *g:diapp_gprbuild_default_gprbuild_options*
		By default, no options are defined (that is the state is the
		same that after an invocation of |:ResetGPRbuildOpt|). Set
		g:diapp_gprbuild_default_gprbuild_options in your |.vimrc| to
		set options by default. Example: >

			:let g:diapp_gprbuild_default_gprbuild_options
				\ = "-eL -XBUILD=DEBUG"
<

:ResetGPRbuildOpt                                          *:ResetGPRbuildOpt*
		Cancel the effect of any previous invocation(s) of
		|:SetGPRbuildOpt|.

:EchoGPRbuildOpt                                            *:EchoGPRbuildOpt*
		Echo the options (if any) defined using |:SetGPRbuildOpt|.

                                                       *g:diapp_gprbuild_lang*
By default, Diapp sets the LANG environment variable to "C" when calling
gprbuild. This makes sure the diagnostic messages will be properly categorized
in the |quickfix| list. You can force another value for LANG by setting
g:diapp_gprbuild_lang to this value in your |.vimrc|. Set
g:diapp_gprbuild_lang to an empty value to prevent Diapp from setting LANG at
all. >

	:let g:diapp_gprbuild_lang = ""
<

GPRbuild invocation~

:GPRbuildCompileCurFile                              *:GPRbuildCompileCurFile*
		Elaborate a GPRbuild command based on the currently edited
		file and the currently selected GNAT project file (if any),
		and run the command. Also, if any diagnostic message (error,
		warning, ...) is issued by GPRbuild, populate the |quickfix|
		list and open the |quickfix-window|.

			If the currently edited file is not a GNAT project
			file (.gpr file), then the GPRbuild command is made to
			compile the currently edited file with the assumption
			it belongs to the currently selected GNAT project
			file. Binding or link edition is not attempted.
			Switches -U ("compilation of file provided on the
			command line") and -f ("forced recompilation") are
			used, and also switch -gnatc ("syntax and semantic
			check only") if the compiled file is an Ada
			specification (.ads file).

			If the currently edited file is a non abstract GNAT
			project file, then the GPRbuild command is made to
			build the project (binding and link edition included).

			If the currently edited file is an abstract GNAT
			project file, then nothing is done.

		In all cases, the -p switch is used ("creation of missing
		directories" (typically the object files and binary files
		directories).

		The other switches used are only to force the diagnostic
		messages format (which is important to reliably populate the
		|quickfix| list).

		All changed buffers are written before executing the GPRbuild
		command.

		After the command execution, a line is saved to
		|message-history| indicating the result of the command
		("Passed" if it terminated with exit status 0 or "Failed" with
		exit status value) and the count of diagnostic messages in the
		|quickfix-window|.

                                        *g:diapp_gprbuild_compile_cur_mapping*
		|:GPRbuildCompileCurFile| is mapped by default to <F10>. Set
		variable g:diapp_gprbuild_compile_cur_mapping in your |.vimrc|
		to map the command to another key. Example with <F4>: >

			:let g:diapp_gprbuild_compile_cur_mapping="<F4>"
<

                                                    *diapp-gprbuild-auto-fill*
For files of type "ada", "c", "cpp" or "fortran", the default pattern for the
|:AF| command is the hyphen ("-").

==============================================================================


FILE RINGS RELATED COMMANDS                                  *diapp-file-ring*

A file ring in Diapp is a short list of files and command |:A| makes it
possible to cycle easily through those files. For example, when you're editing
a C source file (a .c file), |:A| will open the corresponding header file (.h
file) in the current window (only if this file exists).

|:EchoAllFRing| shows all the possible kind of file rings.
|:EchoFRingCandidates| shows the file rings the currently edited file may
belong to. |:EchoFRingNext| shows the name of the file |:A| would open.

Diapp's |:A| command has been inspired by the command with the same name in
plugin a.vim by Mike Sharpe. See
https://www.vim.org/scripts/script.php?script_id=31 or
https://github.com/vim-scripts/a.vim).

                                                      *g:diapp_fring_disabled*
Set g:diapp_fring_disabled to 1 in your |.vimrc| to disable the whole set of
commands described in this section. >

	:let g:diapp_fring_disabled = 1
<

                                                                          *:A*
:A		In the current window, change the edited file to the next file
		in the ring (only if the currently edited file belongs to a
		file ring and at least one of the other file(s) in the ring
		exists). If both files are edited in different windows of the
		current tab page, then the files are swapped in the windows.

                                                               *:EchoAllFRing*
:EchoAllFRing	List all the possible kind of file rings.

:EchoFRingCandidates                                    *:EchoFRingCandidates*
		List all the file rings the currently edited file may belong
		to.

                                                              *:EchoFRingNext*
:EchoFRingNext	Echo the name of the file |:A| would open (only if this file
		exists).

==============================================================================


VIM HELP FILE RELATED ACTIONS AND COMMANDS                     *diapp-vimhelp*

When opening a Vim help file, an `autocommand` is set up so that `helptags` is
run automatically when writing the buffer. The `modeline` on the last line of
the file is also applied (only `textwidth`, `tabstop`, `softtabstop`,
`expandtab` and `rightleft` options).

                                                    *g:diapp_vimhelp_disabled*
Set g:diapp_vimhelp_disabled to 1 in your |.vimrc| to disable the whole set of
features described in this section. >

	:let g:diapp_vimhelp_disabled = 1
<

                                                                         *:FT*
:FT		Toggle the filetype option from empty to "help" (or
		conversely) for the currently edited Vim help file.

                                                     *diapp-vimhelp-auto-fill*
For Vim help files, the default pattern for the |:AF| command is a space
followed by a dot (" .").

==============================================================================

                                                               *diapp-credits*
CREDITS AND LICENSE                                            *diapp-license*

The code of Diapp is by Thierry Rascle <thierr26@free.fr>.

Diapp is released under the MIT license.

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

==============================================================================

 vim:tw=78:ts=8:sts=8:noet:ft=help:norl:
